<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n de Desempe√±o - Analistas de Calidad y Capacitaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .rating-scale { display: flex; gap: 12px; align-items: stretch; flex-wrap: wrap; }
        .rating-option { min-width: 120px; height: 60px; border-radius: 8px; border: 2px solid #01053c; background-color: #01053c; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; padding: 8px; }
        .rating-option:hover { border-color: #1e3a8a; background-color: #1e3a8a; }
        .rating-option.selected { border-color: #3b82f6; background-color: #3b82f6; color: white; }
        .section-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bronze-gradient { background: linear-gradient(135deg, #cd7f32 0%, #b8860b 50%, #8b4513 100%); }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        @keyframes floatReverse {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(20px) rotate(-180deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <!-- Login View (Initial View) -->
    <div id="loginView" class="min-h-screen flex items-center justify-center px-4 relative overflow-hidden">
        <!-- 3D Corporate Blue Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900">
            <!-- Animated geometric shapes -->
            <div class="absolute top-0 left-0 w-full h-full">
                <!-- Large floating cubes -->
                <div class="absolute top-20 left-10 w-32 h-32 bg-blue-600 opacity-10 transform rotate-45 animate-pulse"></div>
                <div class="absolute top-40 right-20 w-24 h-24 bg-indigo-500 opacity-15 transform rotate-12 animate-bounce" style="animation-duration: 3s;"></div>
                <div class="absolute bottom-32 left-1/4 w-20 h-20 bg-blue-400 opacity-20 transform -rotate-12 animate-pulse" style="animation-delay: 1s;"></div>
                <div class="absolute bottom-20 right-1/3 w-28 h-28 bg-indigo-600 opacity-10 transform rotate-45 animate-bounce" style="animation-duration: 4s; animation-delay: 2s;"></div>
                
                <!-- Hexagonal patterns -->
                <div class="absolute top-1/4 left-1/2 transform -translate-x-1/2">
                    <div class="w-16 h-16 bg-blue-500 opacity-20 transform rotate-30" style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); animation: float 6s ease-in-out infinite;"></div>
                </div>
                <div class="absolute bottom-1/4 right-1/4">
                    <div class="w-12 h-12 bg-indigo-400 opacity-25 transform rotate-45" style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); animation: float 8s ease-in-out infinite reverse;"></div>
                </div>
                
                <!-- Gradient orbs -->
                <div class="absolute top-1/3 right-10 w-40 h-40 bg-gradient-to-r from-blue-400 to-indigo-500 opacity-20 rounded-full blur-xl animate-pulse" style="animation-duration: 4s;"></div>
                <div class="absolute bottom-1/3 left-16 w-32 h-32 bg-gradient-to-r from-indigo-400 to-blue-500 opacity-15 rounded-full blur-lg animate-pulse" style="animation-duration: 5s; animation-delay: 1.5s;"></div>
                
                <!-- Grid pattern overlay -->
                <div class="absolute inset-0 opacity-5" style="background-image: linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px); background-size: 50px 50px;"></div>
                
                <!-- Diagonal lines -->
                <div class="absolute top-0 left-0 w-full h-full">
                    <div class="absolute top-0 left-1/4 w-px h-full bg-gradient-to-b from-transparent via-blue-400 to-transparent opacity-20 transform rotate-12"></div>
                    <div class="absolute top-0 right-1/3 w-px h-full bg-gradient-to-b from-transparent via-indigo-400 to-transparent opacity-15 transform -rotate-12"></div>
                </div>
            </div>
            
            <!-- Subtle noise texture overlay -->
            <div class="absolute inset-0 opacity-30" style="background-image: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 0%, transparent 50%);"></div>
        </div>
        <div class="max-w-md w-full space-y-8 relative z-10">
            <!-- Login Card -->
            <div class="bg-white rounded-lg shadow-2xl overflow-hidden backdrop-blur-sm bg-opacity-95 transform perspective-1000 hover:scale-105 transition-all duration-300" style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1); transform-style: preserve-3d; transform: rotateX(5deg) rotateY(-5deg);">
                <!-- Header -->
                <div class="text-white p-8 text-center relative" style="background-color: #01053c; transform: translateZ(25px); background-image: linear-gradient(135deg, #01053c 0%, #1e3a8a 100%);">
                    <div class="flex justify-center mb-4">
                        <!-- Minimalist Evaluation Clipboard Icon -->
                        <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                    </div>
                    <div class="text-3xl font-bold tracking-wider mb-2">PRC333</div>
                    <div class="text-sm text-blue-100 tracking-wide mb-4">SISTEMA DE EVALUACIONES</div>
                    <h1 class="text-2xl font-bold">Iniciar Sesi√≥n</h1>
                    <p class="text-blue-100 mt-2">Acceso al Sistema de Gesti√≥n de Desempe√±o</p>
                </div>
                
                <!-- Login Form -->
                <div class="p-8 relative" style="transform: translateZ(20px);">
                    <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-6">
                        <div>
                            <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                                üë§ Usuario
                            </label>
                            <input 
                                type="text" 
                                id="username" 
                                name="username"
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 transform hover:translateZ-10"
                                style="box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); transform: translateZ(10px);"
                                placeholder="Ingrese su usuario"
                                autocomplete="username"
                            >
                        </div>
                        
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                                üîí Contrase√±a
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="password" 
                                    name="password"
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 transform hover:translateZ-10 pr-12"
                                    style="box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); transform: translateZ(10px);"
                                    placeholder="Ingrese su contrase√±a"
                                    autocomplete="current-password"
                                >
                                <button 
                                    type="button" 
                                    onclick="togglePassword()" 
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                                >
                                    <span id="eyeIcon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        
                        <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                            <span class="mr-2">‚ùå</span>
                            <span id="errorMessage">Usuario o contrase√±a incorrectos</span>
                        </div>
                        
                        <button 
                            type="submit" 
                            class="w-full text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 transform hover:translateZ-10 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                            style="background-color: #01053c; box-shadow: 0 10px 15px -3px rgba(1, 5, 60, 0.3), 0 4px 6px -2px rgba(1, 5, 60, 0.1); transform: translateZ(15px);"
                            id="loginButton"
                        >
                            <span id="loginButtonText">üöÄ Acceder al Sistema</span>
                            <span id="loginSpinner" class="hidden">
                                <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                                Verificando...
                            </span>
                        </button>
                    </form>
                    
                    <!-- Demo Credentials Info -->
                    <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg transform transition-all duration-300" style="box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1), 0 2px 4px -1px rgba(59, 130, 246, 0.06); transform: translateZ(8px);">
                        <h3 class="text-sm font-semibold text-blue-800 mb-2">üìã Credenciales de Acceso</h3>
                        <div class="text-sm text-blue-700 space-y-1">
                            <div><strong>Usuarios:</strong> Admin, CalCap, OP</div>
                            <div><strong>Contrase√±a:</strong> Prc12345</div>
                        </div>
                        <div class="text-xs text-blue-600 mt-2 space-y-1">
                            <div>‚Ä¢ <strong>Admin:</strong> Acceso completo + edici√≥n/eliminaci√≥n</div>
                            <div>‚Ä¢ <strong>CalCap/OP:</strong> Crear evaluaciones</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="text-center text-white text-sm relative z-10">
                <p class="drop-shadow-lg">¬© 2024 Sistema PRC333 - Evaluaciones de Desempe√±o</p>
                <p class="mt-1 drop-shadow-lg opacity-90">Gesti√≥n de Recursos Humanos</p>
            </div>
        </div>
    </div>

    <!-- Dashboard View (Hidden Initially) -->
    <div id="dashboardView" class="max-w-7xl mx-auto px-4 hidden">
        <!-- Dashboard Header -->
        <div class="bg-white rounded-lg shadow-lg mb-8 overflow-hidden">
            <div class="text-white p-6 flex items-center justify-between" style="background-color: #01053c;">
                <div>
                    <h1 class="text-3xl font-bold mb-2">üìä Dashboard de Evaluaciones</h1>
                    <p class="text-blue-100">Sistema de Gesti√≥n de Desempe√±o Laboral - PRC333</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showEvaluationForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center text-sm">
                        <span class="mr-1">‚ûï</span>
                        Nueva Evaluaci√≥n
                    </button>
                    <button onclick="showLogin()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center text-sm">
                        <span class="mr-1">üö™</span>
                        Cerrar Sesi√≥n
                    </button>
                    <div class="flex items-center space-x-3">
                        <!-- Minimalist Evaluation Clipboard Icon -->
                        <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <!-- PRC333 Text -->
                        <div class="text-white">
                            <div class="text-2xl font-bold tracking-wider">PRC333</div>
                            <div class="text-xs text-blue-100 tracking-wide">EVALUACIONES</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div>
            <!-- Filters Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üîç Filtros de An√°lisis</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Desde</label>
                        <input type="date" id="filterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Hasta</label>
                        <input type="date" id="filterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="applyFilters()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cargo</label>
                        <select id="filterCargo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" onchange="applyFilters()">
                            <option value="">Todos los cargos</option>
                            <option value="analista-calidad">Analista de Calidad y Capacitaci√≥n</option>
                            <option value="supervisor-operativo">Supervisor Operativo</option>
                            <option value="supervisor-calidad">Supervisor de Calidad y Capacitaci√≥n</option>
                            <option value="coordinador-operativo">Coordinador Operativo</option>
                            <option value="coordinador-calidad">Coordinador de Calidad y Capacitaci√≥n</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">M√©trica</label>
                        <select id="filterMetric" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" onchange="applyFilters()">
                            <option value="total">Puntuaci√≥n Total</option>
                            <option value="skills">Habilidades</option>
                            <option value="operations">Operatividad</option>
                            <option value="badges">Insignias</option>
                            <option value="points">Puntos de Logros</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4 flex gap-2">
                    <button onclick="clearFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm">
                        Limpiar Filtros
                    </button>
                    <button onclick="exportDashboardData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                        üìä Exportar a Excel
                    </button>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold">Total Evaluaciones</h3>
                            <p class="text-3xl font-bold" id="totalEvaluations">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üìã</div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold">Promedio General</h3>
                            <p class="text-3xl font-bold" id="averageScore">0%</p>
                        </div>
                        <div class="text-4xl opacity-80">üìà</div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold">Mejor Evaluado</h3>
                            <p class="text-lg font-bold" id="topPerformer">-</p>
                        </div>
                        <div class="text-4xl opacity-80">üèÜ</div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold">Total Insignias</h3>
                            <p class="text-3xl font-bold" id="totalBadges">0</p>
                        </div>
                        <div class="text-4xl opacity-80">üèÖ</div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Ranking Chart -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üèÜ Ranking por M√©trica Seleccionada</h3>
                    <div id="rankingChart" class="h-80 overflow-y-auto">
                        <!-- Chart will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Performance Distribution -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä Distribuci√≥n de Desempe√±o</h3>
                    <div id="performanceChart" class="h-80">
                        <!-- Chart will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Detailed Table -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìã Base de Datos de Evaluaciones</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="px-4 py-3">Empleado</th>
                                <th class="px-4 py-3">Cargo</th>
                                <th class="px-4 py-3">Fecha</th>
                                <th class="px-4 py-3">Habilidades</th>
                                <th class="px-4 py-3">Operatividad</th>
                                <th class="px-4 py-3">Total</th>
                                <th class="px-4 py-3">Insignias</th>
                                <th class="px-4 py-3">Puntos</th>
                                <th class="px-4 py-3">Nivel</th>
                                <th class="px-4 py-3">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="evaluationsTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluation Form View (Hidden Initially) -->
    <div id="evaluationView" class="max-w-4xl mx-auto px-4 hidden">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg mb-8 overflow-hidden">
            <div class="text-white p-6 flex items-center justify-between" style="background-color: #01053c;">
                <div>
                    <h1 class="text-3xl font-bold mb-2">Evaluaci√≥n de Desempe√±o Laboral</h1>
                    <p class="text-blue-100" id="dynamicSubtitle">Seleccione un cargo para evaluar</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md text-sm font-normal transition-colors flex items-center opacity-80 hover:opacity-100">
                        <span class="mr-1">‚Üê</span>
                        Volver al Dashboard
                    </button>
                    <div class="flex-shrink-0 flex items-center">
                        <div class="flex items-center space-x-3">
                            <!-- Minimalist Evaluation Clipboard Icon -->
                            <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                            </svg>
                            <!-- PRC333 Text -->
                            <div class="text-white">
                                <div class="text-2xl font-bold tracking-wider">PRC333</div>
                                <div class="text-xs text-blue-100 tracking-wide">EVALUACIONES</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Employee Info -->
            <div class="p-6 bg-gray-50 border-b">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del Evaluado</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nombre completo">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cargo</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white" id="cargoSelect" onchange="updateSubtitle()">
                            <option value="">Seleccionar tipo...</option>
                            <option value="analista-calidad">Analista de Calidad y Capacitaci√≥n</option>
                            <option value="supervisor-operativo">Supervisor Operativo</option>
                            <option value="supervisor-calidad">Supervisor de Calidad y Capacitaci√≥n</option>
                            <option value="coordinador-operativo">Coordinador Operativo</option>
                            <option value="coordinador-calidad">Coordinador de Calidad y Capacitaci√≥n</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Per√≠odo de Evaluaci√≥n - Desde</label>
                        <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" id="evaluationPeriodFrom">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Per√≠odo de Evaluaci√≥n - Hasta</label>
                        <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" id="evaluationPeriodTo">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Evaluador</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nombre del supervisor">
                    </div>
                </div>
            </div>
        </div>

        <!-- Evaluation Sections -->
        <div class="space-y-8">
            <!-- Section 1: Habilidades -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden" id="skillsSection">
                <div class="text-white p-4" style="background-color: #01053c;">
                    <h2 class="text-xl font-semibold">1. Habilidades</h2>
                </div>
                <div class="p-6 space-y-6">
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.1. Adaptabilidad</h3>
                        <p class="text-sm text-gray-600 mb-2">Se ajusta a las diversas situaciones del servicio. Toma en cuenta los cambios de procesos, herramientas e informaciones en tiempo real.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.2. Asertividad</h3>
                        <p class="text-sm text-gray-600 mb-2">Se expresa de forma amable, franca, abierta y directa manteniendo su posici√≥n y negociando las acciones.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.3. Empat√≠a</h3>
                        <p class="text-sm text-gray-600 mb-2">Tienen en consideraci√≥n la posici√≥n y situaci√≥n de las otras personas.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.4. Disposici√≥n</h3>
                        <p class="text-sm text-gray-600 mb-2">Demuestra ser atento ante las necesidades de otros, ofreciendo alternativas y generando cambios en el sistema.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.5. Comunicaci√≥n</h3>
                        <p class="text-sm text-gray-600 mb-2">Mantiene una buena comunicaci√≥n a todo nivel. Reportando, escalando y puntualizando.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.6. Pensamiento Creativo</h3>
                        <p class="text-sm text-gray-600 mb-2">Propone ideas, sugerencias y soluciones no convencionales ante las necesidades, requerimientos y situaciones que lo demanden.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.7. Proactividad</h3>
                        <p class="text-sm text-gray-600 mb-2">Se adelanta ante los posibles eventos y situaciones, dedicando sus acciones de manera preventiva ante lo que pudiese suscitarse.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.8. Capacidad de An√°lisis</h3>
                        <p class="text-sm text-gray-600 mb-2">Interpreta los eventos, casos, situaciones y circunstancias de manera acertada.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.9. Relaciones Interpersonales</h3>
                        <p class="text-sm text-gray-600 mb-2">Mantiene un trato apropiado con sus compa√±eros de trabajo.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.11. Trabajo en Equipo</h3>
                        <p class="text-sm text-gray-600 mb-2">Se enfoca de brindar el aporte necesario al equipo, para alcanzar los objetivos planteados.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.12. Inteligencia Emocional</h3>
                        <p class="text-sm text-gray-600 mb-2">Maneja los gestos, expresiones y formulaciones en los momentos de presi√≥n emocional.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.13. Capacidad de Resoluci√≥n de Conflictos</h3>
                        <p class="text-sm text-gray-600 mb-2">Ante las eventualidades, avoca sus esfuerzos a resolver las situaciones.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.14. Proyecci√≥n</h3>
                        <p class="text-sm text-gray-600 mb-2">Se hace notar como una figura que predica por medio del ejemplo, cumpliendo y haciendo cumplir las normas.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">1.15. Manejo del Tiempo</h3>
                        <p class="text-sm text-gray-600 mb-2">Organiza y distribuye sus actividades para el cumplimiento en los periodos establecidos, teniendo en cuenta su horario de trabajo.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Operatividad -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden" id="operationsSection">
                <div class="text-white p-4" style="background-color: #01053c;">
                    <h2 class="text-xl font-semibold">2. Operatividad</h2>
                </div>
                <div class="p-6 space-y-6">
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">2.1. Asistencia y Puntualidad</h3>
                        <p class="text-sm text-gray-600 mb-2">Cumple con asistir todos los d√≠as en su horario laboral y respeta los tiempos establecidos.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">2.2. Orden y Limpieza</h3>
                        <p class="text-sm text-gray-600 mb-2">Mantiene ordenado los archivos, espacios y materiales en todo momento. Asegura que su √°rea de trabajo se encuentre limpia al inicio y al cierre de gesti√≥n.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">2.3. Cumplimiento de Normativas</h3>
                        <p class="text-sm text-gray-600 mb-2">Cumple con los par√°metros establecidos, dentro de las instalaciones y los hace cumplir de manera oportuna.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">2.4. Cumplimiento de Funciones</h3>
                        <p class="text-sm text-gray-600 mb-2">Realiza de forma ordenada, completa y en los tiempos establecidos las tareas obligatorias para el cargo optado.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-item">
                        <h3 class="font-medium text-gray-800 mb-1">2.5. Cumplimiento de Tareas Asignadas</h3>
                        <p class="text-sm text-gray-600 mb-2">Cumple con todas las asignaciones adicionales durante el per√≠odo evaluado.</p>
                        <div class="rating-scale mb-2">
                            <div class="rating-option" data-value="1">
                                <span class="text-xs text-center">No la posee</span>
                            </div>
                            <div class="rating-option" data-value="2">
                                <span class="text-xs text-center">Posee con oportunidad de mejora</span>
                            </div>
                            <div class="rating-option" data-value="3">
                                <span class="text-xs text-center">Posee la cualidad</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gamification Section -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="text-white p-4" style="background-color: #01053c;">
                    <h2 class="text-xl font-semibold">3. Insignias y Reconocimientos</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Badges Section -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">üèÜ Insignias por Competencias Destacadas</h3>
                            <div class="space-y-3">
                                <div class="badge-item flex items-center p-3 bg-gray-50 rounded-lg border-2 border-transparent hover:border-yellow-300 transition-colors cursor-pointer" onclick="toggleBadge(this, 'comunicador')">
                                    <div class="badge-icon w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-2xl">üí¨</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">Comunicador Excepcional</h4>
                                        <p class="text-sm text-gray-600">Excelencia en comunicaci√≥n y reporte</p>
                                    </div>
                                    <div class="badge-check hidden">
                                        <span class="text-green-500 text-xl">‚úì</span>
                                    </div>
                                </div>
                                
                                <div class="badge-item flex items-center p-3 bg-gray-50 rounded-lg border-2 border-transparent hover:border-yellow-300 transition-colors cursor-pointer" onclick="toggleBadge(this, 'lider')">
                                    <div class="badge-icon w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-2xl">üëë</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">L√≠der Natural</h4>
                                        <p class="text-sm text-gray-600">Liderazgo y trabajo en equipo sobresaliente</p>
                                    </div>
                                    <div class="badge-check hidden">
                                        <span class="text-green-500 text-xl">‚úì</span>
                                    </div>
                                </div>
                                
                                <div class="badge-item flex items-center p-3 bg-gray-50 rounded-lg border-2 border-transparent hover:border-yellow-300 transition-colors cursor-pointer" onclick="toggleBadge(this, 'innovador')">
                                    <div class="badge-icon w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-2xl">üí°</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">Innovador Creativo</h4>
                                        <p class="text-sm text-gray-600">Pensamiento creativo y soluciones innovadoras</p>
                                    </div>
                                    <div class="badge-check hidden">
                                        <span class="text-green-500 text-xl">‚úì</span>
                                    </div>
                                </div>
                                
                                <div class="badge-item flex items-center p-3 bg-gray-50 rounded-lg border-2 border-transparent hover:border-yellow-300 transition-colors cursor-pointer" onclick="toggleBadge(this, 'analista')">
                                    <div class="badge-icon w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-2xl">üîç</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">Analista Experto</h4>
                                        <p class="text-sm text-gray-600">Capacidad de an√°lisis excepcional</p>
                                    </div>
                                    <div class="badge-check hidden">
                                        <span class="text-green-500 text-xl">‚úì</span>
                                    </div>
                                </div>
                                
                                <div class="badge-item flex items-center p-3 bg-gray-50 rounded-lg border-2 border-transparent hover:border-yellow-300 transition-colors cursor-pointer" onclick="toggleBadge(this, 'proactivo')">
                                    <div class="badge-icon w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-2xl">‚ö°</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">Proactivo Ejemplar</h4>
                                        <p class="text-sm text-gray-600">Iniciativa y anticipaci√≥n sobresaliente</p>
                                    </div>
                                    <div class="badge-check hidden">
                                        <span class="text-green-500 text-xl">‚úì</span>
                                    </div>
                                </div>
                                
                                <div class="badge-item flex items-center p-3 bg-gray-50 rounded-lg border-2 border-transparent hover:border-yellow-300 transition-colors cursor-pointer" onclick="toggleBadge(this, 'confiable')">
                                    <div class="badge-icon w-12 h-12 bg-teal-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-2xl">üéØ</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-800">Confiabilidad Total</h4>
                                        <p class="text-sm text-gray-600">Cumplimiento y puntualidad perfecta</p>
                                    </div>
                                    <div class="badge-check hidden">
                                        <span class="text-green-500 text-xl">‚úì</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Achievement Points Section -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">üåü Puntos por Logros Alcanzados</h3>
                            <div class="space-y-4">
                                <div class="achievement-level bronze-gradient text-white p-4 rounded-lg cursor-pointer" onclick="selectLevel(this, 'bronce', 100)">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-semibold">ü•â Nivel Bronce</h4>
                                            <p class="text-sm opacity-90">Desempe√±o satisfactorio</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold">100</div>
                                            <div class="text-xs">puntos</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="achievement-level bg-gradient-to-r from-gray-400 to-gray-600 text-white p-4 rounded-lg cursor-pointer" onclick="selectLevel(this, 'plata', 250)">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-semibold">ü•à Nivel Plata</h4>
                                            <p class="text-sm opacity-90">Desempe√±o sobresaliente</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold">250</div>
                                            <div class="text-xs">puntos</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="achievement-level bg-gradient-to-r from-yellow-400 to-yellow-600 text-white p-4 rounded-lg cursor-pointer" onclick="selectLevel(this, 'oro', 500)">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-semibold">ü•á Nivel Oro</h4>
                                            <p class="text-sm opacity-90">Desempe√±o excepcional</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold">500</div>
                                            <div class="text-xs">puntos</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="achievement-level bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg cursor-pointer" onclick="selectLevel(this, 'diamante', 1000)">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-semibold">üíé Nivel Diamante</h4>
                                            <p class="text-sm opacity-90">Desempe√±o extraordinario</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold">1000</div>
                                            <div class="text-xs">puntos</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Achievement Summary -->
                            <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                                <h4 class="font-semibold text-gray-800 mb-2">Resumen de Logros</h4>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div class="text-2xl font-bold text-blue-600" id="badgeCount">0</div>
                                        <div class="text-sm text-gray-600">Insignias</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-purple-600" id="achievementPoints">0</div>
                                        <div class="text-sm text-gray-600">Puntos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="text-white p-4" style="background-color: #01053c;">
                    <h2 class="text-xl font-semibold">4. Comentarios y Observaciones</h2>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fortalezas identificadas</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-24" placeholder="Describa las principales fortalezas del empleado..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">√Åreas de mejora</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-24" placeholder="Identifique las √°reas que requieren desarrollo..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Plan de desarrollo profesional</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-24" placeholder="Proponga acciones espec√≠ficas para el crecimiento profesional..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Results Summary -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="text-white p-4" style="background-color: #01053c;">
                    <h2 class="text-xl font-semibold">Resumen de Evaluaci√≥n</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-800 mb-2">Puntuaci√≥n Total</h3>
                            <div class="text-3xl font-bold text-blue-600" id="totalScore">0%</div>
                            <div class="text-sm text-gray-500 mt-1" id="sectionBreakdown">Habilidades: 0% | Operatividad: 0%</div>
                            <div class="text-sm text-gray-600 mt-2" id="performanceLevel">Calculando...</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-800 mb-2">Recomendaci√≥n</h3>
                            <div class="text-lg font-medium" id="recommendation">Seleccione las calificaciones para ver la recomendaci√≥n</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="generateReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                    üóÑÔ∏è Generar Reporte
                </button>
                <button onclick="resetForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                    üßπ Limpiar Formulario
                </button>
                <button onclick="printEvaluation()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-medium transition-colors">
                    üìÑ Descargar PDF
                </button>
            </div>
        </div>
    </div>



    <script>
        // Rating system functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dashboard on page load
            loadDashboardData();
            
            const ratingOptions = document.querySelectorAll('.rating-option');
            
            ratingOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const parent = this.parentElement;
                    const siblings = parent.querySelectorAll('.rating-option');
                    
                    // Remove selected class from all siblings
                    siblings.forEach(sibling => sibling.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Update total score
                    updateTotalScore();
                });
            });
        });

        function updateTotalScore() {
            // Get all evaluation items in Skills section (first 14 items)
            const skillsItems = document.querySelectorAll('#skillsSection .evaluation-item .rating-option.selected');
            // Get all evaluation items in Operations section (last 5 items)
            const operationsItems = document.querySelectorAll('#operationsSection .evaluation-item .rating-option.selected');
            
            let skillsScore = 0;
            let operationsScore = 0;
            
            // Calculate Skills score with specific weightings
            skillsItems.forEach(rating => {
                const value = parseInt(rating.dataset.value);
                if (value === 3) {
                    skillsScore += 3.57; // Posee la cualidad
                } else if (value === 2) {
                    skillsScore += 1.79; // Posee con oportunidad de mejora
                } else {
                    skillsScore += 0; // No la posee
                }
            });
            
            // Calculate Operations score with specific weightings
            operationsItems.forEach(rating => {
                const value = parseInt(rating.dataset.value);
                if (value === 3) {
                    operationsScore += 10; // Posee la cualidad
                } else if (value === 2) {
                    operationsScore += 5; // Posee con oportunidad de mejora
                } else {
                    operationsScore += 0; // No la posee
                }
            });
            
            const totalPercentage = Math.round(skillsScore + operationsScore);
            const maxSkillsScore = 14 * 3.57; // 14 skills items √ó 3.57%
            const maxOperationsScore = 5 * 10; // 5 operations items √ó 10%
            
            document.getElementById('totalScore').textContent = `${totalPercentage}%`;
            document.getElementById('sectionBreakdown').textContent = `Habilidades: ${skillsScore.toFixed(1)}% | Operatividad: ${operationsScore.toFixed(1)}%`;
            
            // Update performance level
            let performanceLevel = '';
            let recommendation = '';
            
            if (totalPercentage >= 90) {
                performanceLevel = 'Desempe√±o Sobresaliente';
                recommendation = 'Considerar para promoci√≥n o roles de mayor responsabilidad';
                document.getElementById('performanceLevel').className = 'text-sm text-green-600 mt-2 font-medium';
                document.getElementById('recommendation').className = 'text-lg font-medium text-green-600';
            } else if (totalPercentage >= 80) {
                performanceLevel = 'Desempe√±o Bueno';
                recommendation = 'Mantener el buen trabajo y buscar oportunidades de crecimiento';
                document.getElementById('performanceLevel').className = 'text-sm text-blue-600 mt-2 font-medium';
                document.getElementById('recommendation').className = 'text-lg font-medium text-blue-600';
            } else if (totalPercentage >= 70) {
                performanceLevel = 'Desempe√±o Regular';
                recommendation = 'Enfocarse en √°reas de mejora espec√≠ficas';
                document.getElementById('performanceLevel').className = 'text-sm text-yellow-600 mt-2 font-medium';
                document.getElementById('recommendation').className = 'text-lg font-medium text-yellow-600';
            } else {
                performanceLevel = 'Desempe√±o Deficiente';
                recommendation = 'Requiere intervenci√≥n inmediata y plan de mejora intensivo';
                document.getElementById('performanceLevel').className = 'text-sm text-red-600 mt-2 font-medium';
                document.getElementById('recommendation').className = 'text-lg font-medium text-red-600';
            }
            
            document.getElementById('performanceLevel').textContent = performanceLevel;
            document.getElementById('recommendation').textContent = recommendation;
        }

        function generateReport() {
            const employeeName = document.querySelector('input[placeholder="Nombre completo"]').value;
            const evaluationPeriodFrom = document.getElementById('evaluationPeriodFrom').value;
            const evaluationPeriodTo = document.getElementById('evaluationPeriodTo').value;
            const evaluator = document.querySelector('input[placeholder="Nombre del supervisor"]').value;
            const cargo = document.getElementById('cargoSelect').value;
            
            if (!employeeName || !evaluationPeriodFrom || !evaluationPeriodTo || !evaluator || !cargo) {
                alert('Por favor complete toda la informaci√≥n b√°sica del empleado antes de generar el reporte.');
                return;
            }
            
            const selectedRatings = document.querySelectorAll('.rating-option.selected');
            if (selectedRatings.length === 0) {
                alert('Por favor complete al menos una evaluaci√≥n antes de generar el reporte.');
                return;
            }
            
            // Collect all evaluation data
            const evaluationData = {
                employeeName: employeeName,
                evaluationPeriodFrom: evaluationPeriodFrom,
                evaluationPeriodTo: evaluationPeriodTo,
                evaluator: evaluator,
                cargo: cargo,
                createdBy: currentUser ? currentUser.username : 'Unknown',
                timestamp: new Date().toISOString(),
                skills: {},
                operations: {},
                badges: Array.from(selectedBadges),
                achievementLevel: selectedLevel,
                achievementPoints: selectedPoints,
                comments: {
                    strengths: document.querySelector('textarea[placeholder*="fortalezas"]').value,
                    improvements: document.querySelector('textarea[placeholder*="mejora"]').value,
                    developmentPlan: document.querySelector('textarea[placeholder*="crecimiento"]').value
                },
                totalScore: document.getElementById('totalScore').textContent,
                performanceLevel: document.getElementById('performanceLevel').textContent
            };
            
            // Collect skills ratings
            const skillsSection = document.getElementById('skillsSection');
            const skillsItems = skillsSection.querySelectorAll('.evaluation-item');
            skillsItems.forEach((item, index) => {
                const title = item.querySelector('h3').textContent;
                const selectedRating = item.querySelector('.rating-option.selected');
                if (selectedRating) {
                    evaluationData.skills[title] = parseInt(selectedRating.dataset.value);
                }
            });
            
            // Collect operations ratings
            const operationsSection = document.getElementById('operationsSection');
            const operationsItems = operationsSection.querySelectorAll('.evaluation-item');
            operationsItems.forEach((item, index) => {
                const title = item.querySelector('h3').textContent;
                const selectedRating = item.querySelector('.rating-option.selected');
                if (selectedRating) {
                    evaluationData.operations[title] = parseInt(selectedRating.dataset.value);
                }
            });
            
            // Save to API database
            saveToAPIDatabase(evaluationData, true);
        }
        
        // API Database functions
        async function saveToAPIDatabase(data, shouldClearForm = false) {
            try {
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                loadingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                        <span>Guardando en base de datos...</span>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
                
                // Add unique ID and flatten data for API
                data.id = Date.now().toString();
                
                // Flatten the data structure for SheetDB
                const flattenedData = {
                    id: data.id,
                    employeeName: data.employeeName,
                    evaluationPeriodFrom: data.evaluationPeriodFrom,
                    evaluationPeriodTo: data.evaluationPeriodTo,
                    evaluator: data.evaluator,
                    cargo: data.cargo,
                    createdBy: data.createdBy,
                    timestamp: data.timestamp,
                    totalScore: data.totalScore,
                    performanceLevel: data.performanceLevel,
                    badges: JSON.stringify(data.badges),
                    achievementLevel: data.achievementLevel || '',
                    achievementPoints: data.achievementPoints || 0,
                    skills: JSON.stringify(data.skills),
                    operations: JSON.stringify(data.operations),
                    comments: JSON.stringify(data.comments)
                };
                
                // Send to SheetDB API
                const response = await fetch('https://sheetdb.io/api/v1/y605fdzbz5fir', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data: [flattenedData]
                    })
                });
                
                loadingDiv.remove();
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="mr-2">‚úÖ</span>
                                <div>
                                    <div class="font-semibold">Evaluaci√≥n Guardada en Base de Datos</div>
                                    <div class="text-sm">ID: ${data.id} ‚Ä¢ ${data.employeeName}</div>
                                    <div class="text-xs">Sincronizado con SheetDB</div>
                                </div>
                            </div>
                            <button onclick="loadDashboardFromAPI(); showDashboard(); this.parentElement.parentElement.remove();" class="ml-4 bg-green-700 hover:bg-green-800 px-3 py-1 rounded text-sm">
                                Ver Dashboard
                            </button>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    // Clear form if requested
                    if (shouldClearForm) {
                        setTimeout(() => {
                            clearFormAfterSave();
                        }, 1000);
                    }
                    
                    // Remove success message after 8 seconds
                    setTimeout(() => {
                        if (successDiv.parentElement) {
                            successDiv.remove();
                        }
                    }, 8000);
                    
                    console.log('Evaluaci√≥n guardada en API:', result);
                    
                } else {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
            } catch (error) {
                // Remove loading message if it exists
                const loadingDiv = document.querySelector('.fixed.top-4.right-4.bg-blue-500');
                if (loadingDiv) loadingDiv.remove();
                
                console.error('API save error:', error);
                
                // Show error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                errorDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="mr-2">‚ùå</span>
                        <div>
                            <div class="font-semibold">Error al Guardar</div>
                            <div class="text-sm">Guardando localmente como respaldo</div>
                        </div>
                    </div>
                `;
                document.body.appendChild(errorDiv);
                
                // Fallback to localStorage
                saveToLocalStorage(data, shouldClearForm);
                
                setTimeout(() => {
                    if (errorDiv.parentElement) {
                        errorDiv.remove();
                    }
                }, 5000);
            }
        }
        
        function saveToLocalStorage(data, shouldClearForm = false) {
            try {
                // Get existing evaluations from localStorage
                let evaluations = JSON.parse(localStorage.getItem('performanceEvaluations') || '[]');
                
                // Add new evaluation with unique ID if not already set
                if (!data.id) {
                    data.id = Date.now().toString();
                }
                evaluations.push(data);
                
                // Save back to localStorage
                localStorage.setItem('performanceEvaluations', JSON.stringify(evaluations));
                
                // Show success message with option to go to dashboard
                const successDiv = document.createElement('div');
                successDiv.className = 'fixed top-4 right-4 bg-orange-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                successDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="mr-2">üíæ</span>
                            <div>
                                <div class="font-semibold">Evaluaci√≥n Guardada Localmente</div>
                                <div class="text-sm">ID: ${data.id} ‚Ä¢ ${data.employeeName}</div>
                                <div class="text-xs">Respaldo local activo</div>
                            </div>
                        </div>
                        <button onclick="showDashboard(); this.parentElement.parentElement.remove();" class="ml-4 bg-orange-700 hover:bg-orange-800 px-3 py-1 rounded text-sm">
                            Ver Dashboard
                        </button>
                    </div>
                `;
                document.body.appendChild(successDiv);
                
                // Clear form if requested (when generating report)
                if (shouldClearForm) {
                    setTimeout(() => {
                        clearFormAfterSave();
                    }, 1000);
                }
                
                // Remove success message after 8 seconds
                setTimeout(() => {
                    if (successDiv.parentElement) {
                        successDiv.remove();
                    }
                }, 8000);
                
                console.log('Evaluaci√≥n guardada localmente:', data);
                
            } catch (error) {
                alert('Error al guardar la evaluaci√≥n: ' + error.message);
                console.error('Local save error:', error);
            }
        }

        function clearFormAfterSave() {
            // Clear all input fields
            document.querySelectorAll('input, textarea').forEach(field => {
                field.value = '';
            });
            
            // Clear cargo selection
            document.getElementById('cargoSelect').value = '';
            updateSubtitle();
            
            // Clear all ratings
            document.querySelectorAll('.rating-option.selected').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Reset score display
            document.getElementById('totalScore').textContent = '0%';
            document.getElementById('sectionBreakdown').textContent = 'Habilidades: 0% | Operatividad: 0%';
            document.getElementById('performanceLevel').textContent = 'Calculando...';
            document.getElementById('performanceLevel').className = 'text-sm text-gray-600 mt-2';
            document.getElementById('recommendation').textContent = 'Seleccione las calificaciones para ver la recomendaci√≥n';
            document.getElementById('recommendation').className = 'text-lg font-medium';
            
            // Reset gamification elements
            selectedBadges.clear();
            selectedLevel = null;
            selectedPoints = 0;
            
            // Reset badge selections
            document.querySelectorAll('.badge-item').forEach(badge => {
                badge.classList.remove('border-yellow-400', 'bg-yellow-50');
                badge.classList.add('border-transparent', 'bg-gray-50');
                badge.querySelector('.badge-check').classList.add('hidden');
            });
            
            // Reset level selections
            document.querySelectorAll('.achievement-level').forEach(level => {
                level.classList.remove('ring-4', 'ring-white', 'ring-opacity-50', 'transform', 'scale-105');
            });
            
            // Reset gamification summary
            document.getElementById('badgeCount').textContent = '0';
            document.getElementById('achievementPoints').textContent = '0';
            
            // Show form cleared message
            const clearedDiv = document.createElement('div');
            clearedDiv.className = 'fixed top-20 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            clearedDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">üßπ</span>
                    <div>
                        <div class="font-semibold">Formulario Limpiado</div>
                        <div class="text-sm">Listo para nueva evaluaci√≥n</div>
                    </div>
                </div>
            `;
            document.body.appendChild(clearedDiv);
            
            setTimeout(() => {
                if (clearedDiv.parentElement) {
                    clearedDiv.remove();
                }
            }, 3000);
        }

        function resetForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todo el formulario? Esta acci√≥n no se puede deshacer.')) {
                // Clear all input fields
                document.querySelectorAll('input, textarea').forEach(field => {
                    field.value = '';
                });
                
                // Clear all ratings
                document.querySelectorAll('.rating-option.selected').forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Reset score display
                document.getElementById('totalScore').textContent = '0%';
                document.getElementById('sectionBreakdown').textContent = 'Habilidades: 0% | Operatividad: 0%';
                document.getElementById('performanceLevel').textContent = 'Calculando...';
                document.getElementById('performanceLevel').className = 'text-sm text-gray-600 mt-2';
                document.getElementById('recommendation').textContent = 'Seleccione las calificaciones para ver la recomendaci√≥n';
                document.getElementById('recommendation').className = 'text-lg font-medium';
                
                // Reset gamification elements
                selectedBadges.clear();
                selectedLevel = null;
                selectedPoints = 0;
                
                // Reset badge selections
                document.querySelectorAll('.badge-item').forEach(badge => {
                    badge.classList.remove('border-yellow-400', 'bg-yellow-50');
                    badge.classList.add('border-transparent', 'bg-gray-50');
                    badge.querySelector('.badge-check').classList.add('hidden');
                });
                
                // Reset level selections
                document.querySelectorAll('.achievement-level').forEach(level => {
                    level.classList.remove('ring-4', 'ring-white', 'ring-opacity-50', 'transform', 'scale-105');
                });
                
                // Reset gamification summary
                document.getElementById('badgeCount').textContent = '0';
                document.getElementById('achievementPoints').textContent = '0';
                
                alert('Formulario limpiado exitosamente.');
            }
        }

        function printEvaluation() {
            const employeeName = document.querySelector('input[placeholder="Nombre completo"]').value;
            const evaluationPeriodFrom = document.getElementById('evaluationPeriodFrom').value;
            const evaluationPeriodTo = document.getElementById('evaluationPeriodTo').value;
            const evaluator = document.querySelector('input[placeholder="Nombre del supervisor"]').value;
            const cargo = document.getElementById('cargoSelect').value;
            
            if (!employeeName || !evaluationPeriodFrom || !evaluationPeriodTo || !evaluator || !cargo) {
                alert('Por favor complete toda la informaci√≥n b√°sica del empleado antes de exportar a PDF.');
                return;
            }
            
            const selectedRatings = document.querySelectorAll('.rating-option.selected');
            if (selectedRatings.length === 0) {
                alert('Por favor complete al menos una evaluaci√≥n antes de exportar a PDF.');
                return;
            }
            
            // Show loading message
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'fixed top-4 right-4 bg-purple-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            loadingDiv.innerHTML = `
                <div class="flex items-center">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                    <span>Generando PDF...</span>
                </div>
            `;
            document.body.appendChild(loadingDiv);
            
            // Generate visual PDF without clearing data
            setTimeout(() => {
                generateVisualPDF();
                loadingDiv.remove();
            }, 1000);
        }
        
        function generateVisualPDF() {
            try {
                const employeeName = document.querySelector('input[placeholder="Nombre completo"]').value;
                
                // Hide action buttons temporarily for clean capture
                const actionButtons = document.querySelector('.flex.flex-col.sm\\:flex-row.gap-4.justify-center');
                actionButtons.style.display = 'none';
                
                // Create a container for the entire evaluation
                const evaluationContainer = document.querySelector('.max-w-4xl.mx-auto.px-4');
                
                // Use html2canvas to capture the visual content
                html2canvas(evaluationContainer, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#f9fafb',
                    width: evaluationContainer.scrollWidth,
                    height: evaluationContainer.scrollHeight,
                    scrollX: 0,
                    scrollY: 0
                }).then(canvas => {
                    // Show action buttons again
                    actionButtons.style.display = 'flex';
                    
                    // Initialize jsPDF
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    // Calculate dimensions
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 295; // A4 height in mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    // Add first page
                    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // Add additional pages if needed
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // Generate filename
                    const fileName = `Evaluacion_Visual_${employeeName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                    
                    // Save the PDF
                    pdf.save(fileName);
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-purple-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="mr-2">üìÑ</span>
                            <div>
                                <div class="font-semibold">PDF Descargado Exitosamente</div>
                                <div class="text-sm">${fileName}</div>
                                <div class="text-xs mt-1">Los datos permanecen en el formulario</div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    setTimeout(() => {
                        successDiv.remove();
                    }, 5000);
                    
                }).catch(error => {
                    // Show action buttons again in case of error
                    actionButtons.style.display = 'flex';
                    console.error('Error capturing evaluation:', error);
                    alert('Error al capturar la evaluaci√≥n visual. Por favor, intente nuevamente.');
                });
                
            } catch (error) {
                console.error('Error generating visual PDF:', error);
                alert('Error al generar el PDF visual. Por favor, intente nuevamente.');
            }
        }

        // Update subtitle based on selected position
        function updateSubtitle() {
            const cargoSelect = document.getElementById('cargoSelect');
            const subtitle = document.getElementById('dynamicSubtitle');
            
            const cargoTexts = {
                'analista-calidad': 'Analista de Calidad y Capacitaci√≥n',
                'supervisor-operativo': 'Supervisor Operativo',
                'supervisor-calidad': 'Supervisor de Calidad y Capacitaci√≥n',
                'coordinador-operativo': 'Coordinador Operativo',
                'coordinador-calidad': 'Coordinador de Calidad y Capacitaci√≥n'
            };
            
            if (cargoSelect.value && cargoTexts[cargoSelect.value]) {
                subtitle.textContent = cargoTexts[cargoSelect.value];
            } else {
                subtitle.textContent = 'Seleccione un cargo para evaluar';
            }
        }

        // Gamification functions
        let selectedBadges = new Set();
        let selectedLevel = null;
        let selectedPoints = 0;

        function toggleBadge(element, badgeId) {
            const checkElement = element.querySelector('.badge-check');
            
            if (selectedBadges.has(badgeId)) {
                // Remove badge
                selectedBadges.delete(badgeId);
                checkElement.classList.add('hidden');
                element.classList.remove('border-yellow-400', 'bg-yellow-50');
                element.classList.add('border-transparent', 'bg-gray-50');
            } else {
                // Add badge
                selectedBadges.add(badgeId);
                checkElement.classList.remove('hidden');
                element.classList.remove('border-transparent', 'bg-gray-50');
                element.classList.add('border-yellow-400', 'bg-yellow-50');
            }
            
            updateGamificationSummary();
        }

        function selectLevel(element, levelId, points) {
            // Remove selection from all levels
            document.querySelectorAll('.achievement-level').forEach(level => {
                level.classList.remove('ring-4', 'ring-white', 'ring-opacity-50', 'transform', 'scale-105');
            });
            
            // Add selection to clicked level
            element.classList.add('ring-4', 'ring-white', 'ring-opacity-50', 'transform', 'scale-105');
            
            selectedLevel = levelId;
            selectedPoints = points;
            
            updateGamificationSummary();
        }

        function updateGamificationSummary() {
            document.getElementById('badgeCount').textContent = selectedBadges.size;
            document.getElementById('achievementPoints').textContent = selectedPoints;
        }

        // Global user session
        let currentUser = null;
        
        // Login functionality
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            const loginButtonText = document.getElementById('loginButtonText');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginError = document.getElementById('loginError');
            
            // Hide any previous error
            loginError.classList.add('hidden');
            
            // Show loading state
            loginButtonText.classList.add('hidden');
            loginSpinner.classList.remove('hidden');
            loginButton.disabled = true;
            
            // Simulate authentication delay
            setTimeout(() => {
                // Check credentials for different user roles
                if ((username === 'Admin' || username === 'CalCap' || username === 'OP') && password === 'Prc12345') {
                    // Set current user session
                    currentUser = {
                        username: username,
                        role: username,
                        loginTime: new Date().toISOString()
                    };
                    
                    // Successful login
                    showSuccessLogin(username);
                    setTimeout(() => {
                        showDashboard();
                    }, 1500);
                } else {
                    // Failed login
                    showLoginError();
                }
                
                // Reset button state
                loginButtonText.classList.remove('hidden');
                loginSpinner.classList.add('hidden');
                loginButton.disabled = false;
            }, 1000);
        }
        
        function showSuccessLogin(username) {
            const roleNames = {
                'Admin': 'Administrador',
                'CalCap': 'Calidad y Capacitaci√≥n',
                'OP': 'Operativo'
            };
            
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            successDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">‚úÖ</span>
                    <div>
                        <div class="font-semibold">Acceso Autorizado</div>
                        <div class="text-sm">Bienvenido ${username} - ${roleNames[username] || username}</div>
                        <div class="text-xs">Sistema PRC333</div>
                    </div>
                </div>
            `;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                if (successDiv.parentElement) {
                    successDiv.remove();
                }
            }, 3000);
        }
        
        function showLoginError() {
            const loginError = document.getElementById('loginError');
            loginError.classList.remove('hidden');
            
            // Add shake animation
            const loginForm = document.getElementById('loginForm');
            loginForm.style.animation = 'shake 0.5s ease-in-out';
            
            setTimeout(() => {
                loginForm.style.animation = '';
            }, 500);
        }
        
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                eyeIcon.textContent = 'üëÅÔ∏è';
            }
        }

        // Navigation functions
        function showDashboard() {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('evaluationView').classList.add('hidden');
            loadDashboardData();
        }

        function showEvaluationForm() {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('evaluationView').classList.remove('hidden');
        }
        
        function showLogin() {
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('evaluationView').classList.add('hidden');
            
            // Clear login form
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').classList.add('hidden');
        }

        // Dashboard functionality
        let filteredEvaluations = [];
        let allEvaluations = [];

        function loadDashboardData() {
            // Try to load from API first, fallback to localStorage
            loadDashboardFromAPI();
        }
        
        async function loadDashboardFromAPI() {
            try {
                // Show loading indicator
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'fixed top-4 left-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                loadingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                        <span class="text-sm">Cargando datos...</span>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
                
                // Fetch data from SheetDB API
                const response = await fetch('https://sheetdb.io/api/v1/y605fdzbz5fir');
                
                if (response.ok) {
                    const apiData = await response.json();
                    
                    // Transform API data back to our format
                    allEvaluations = apiData.map(item => {
                        try {
                            return {
                                id: item.id,
                                employeeName: item.employeeName,
                                evaluationPeriodFrom: item.evaluationPeriodFrom,
                                evaluationPeriodTo: item.evaluationPeriodTo,
                                evaluationPeriod: item.evaluationPeriodFrom, // For compatibility
                                evaluator: item.evaluator,
                                cargo: item.cargo,
                                createdBy: item.createdBy,
                                timestamp: item.timestamp,
                                totalScore: item.totalScore,
                                performanceLevel: item.performanceLevel,
                                badges: JSON.parse(item.badges || '[]'),
                                achievementLevel: item.achievementLevel,
                                achievementPoints: parseInt(item.achievementPoints) || 0,
                                skills: JSON.parse(item.skills || '{}'),
                                operations: JSON.parse(item.operations || '{}'),
                                comments: JSON.parse(item.comments || '{}')
                            };
                        } catch (parseError) {
                            console.error('Error parsing evaluation data:', parseError, item);
                            return null;
                        }
                    }).filter(item => item !== null);
                    
                    // Update localStorage with API data
                    localStorage.setItem('performanceEvaluations', JSON.stringify(allEvaluations));
                    
                    loadingDiv.remove();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 left-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="mr-2">üîÑ</span>
                            <span class="text-sm">Datos sincronizados (${allEvaluations.length} evaluaciones)</span>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    setTimeout(() => {
                        if (successDiv.parentElement) {
                            successDiv.remove();
                        }
                    }, 3000);
                    
                } else {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error loading from API:', error);
                
                // Remove loading indicator
                const loadingDiv = document.querySelector('.fixed.top-4.left-4.bg-blue-500');
                if (loadingDiv) loadingDiv.remove();
                
                // Fallback to localStorage
                loadDashboardFromLocalStorage();
                
                // Show fallback message
                const fallbackDiv = document.createElement('div');
                fallbackDiv.className = 'fixed top-4 left-4 bg-orange-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                fallbackDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="mr-2">üíæ</span>
                        <span class="text-sm">Usando datos locales</span>
                    </div>
                `;
                document.body.appendChild(fallbackDiv);
                
                setTimeout(() => {
                    if (fallbackDiv.parentElement) {
                        fallbackDiv.remove();
                    }
                }, 3000);
            }
            
            filteredEvaluations = [...allEvaluations];
            updateDashboard();
        }
        
        function loadDashboardFromLocalStorage() {
            try {
                // Load evaluations from localStorage
                allEvaluations = JSON.parse(localStorage.getItem('performanceEvaluations') || '[]');
                
                // Add sample data if no evaluations exist
                if (allEvaluations.length === 0) {
                    generateSampleData();
                    allEvaluations = JSON.parse(localStorage.getItem('performanceEvaluations') || '[]');
                }
                
                filteredEvaluations = [...allEvaluations];
                updateDashboard();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                alert('Error al cargar los datos del dashboard');
            }
        }

        function generateSampleData() {
            const sampleEvaluations = [
                {
                    id: '1701234567890',
                    employeeName: 'Mar√≠a Gonz√°lez',
                    evaluationPeriod: '2024-01-15',
                    evaluator: 'Carlos Rodr√≠guez',
                    timestamp: '2024-01-15T10:30:00.000Z',
                    skills: { '1.1. Adaptabilidad': 3, '1.2. Asertividad': 3, '1.3. Empat√≠a': 2, '1.4. Disposici√≥n': 3, '1.5. Comunicaci√≥n': 3 },
                    operations: { '2.1. Asistencia y Puntualidad': 3, '2.2. Orden y Limpieza': 3, '2.3. Cumplimiento de Normativas': 2 },
                    badges: ['comunicador', 'lider'],
                    achievementLevel: 'oro',
                    achievementPoints: 500,
                    totalScore: '85%',
                    performanceLevel: 'Desempe√±o Bueno',
                    cargo: 'analista-calidad'
                },
                {
                    id: '1701234567891',
                    employeeName: 'Juan P√©rez',
                    evaluationPeriod: '2024-01-20',
                    evaluator: 'Ana L√≥pez',
                    timestamp: '2024-01-20T14:15:00.000Z',
                    skills: { '1.1. Adaptabilidad': 2, '1.2. Asertividad': 2, '1.3. Empat√≠a': 3, '1.4. Disposici√≥n': 2, '1.5. Comunicaci√≥n': 2 },
                    operations: { '2.1. Asistencia y Puntualidad': 3, '2.2. Orden y Limpieza': 2, '2.3. Cumplimiento de Normativas': 3 },
                    badges: ['analista'],
                    achievementLevel: 'plata',
                    achievementPoints: 250,
                    totalScore: '72%',
                    performanceLevel: 'Desempe√±o Regular',
                    cargo: 'supervisor-operativo'
                },
                {
                    id: '1701234567892',
                    employeeName: 'Laura Mart√≠nez',
                    evaluationPeriod: '2024-02-05',
                    evaluator: 'Roberto Silva',
                    timestamp: '2024-02-05T09:45:00.000Z',
                    skills: { '1.1. Adaptabilidad': 3, '1.2. Asertividad': 3, '1.3. Empat√≠a': 3, '1.4. Disposici√≥n': 3, '1.5. Comunicaci√≥n': 3 },
                    operations: { '2.1. Asistencia y Puntualidad': 3, '2.2. Orden y Limpieza': 3, '2.3. Cumplimiento de Normativas': 3 },
                    badges: ['comunicador', 'lider', 'innovador', 'proactivo'],
                    achievementLevel: 'diamante',
                    achievementPoints: 1000,
                    totalScore: '95%',
                    performanceLevel: 'Desempe√±o Sobresaliente',
                    cargo: 'coordinador-calidad'
                }
            ];
            
            localStorage.setItem('performanceEvaluations', JSON.stringify(sampleEvaluations));
        }

        function applyFilters() {
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            const cargo = document.getElementById('filterCargo').value;
            
            filteredEvaluations = allEvaluations.filter(evaluation => {
                let passesFilter = true;
                
                // Date filter
                if (dateFrom) {
                    const evalDate = new Date(evaluation.evaluationPeriod);
                    const fromDate = new Date(dateFrom);
                    if (evalDate < fromDate) passesFilter = false;
                }
                
                if (dateTo) {
                    const evalDate = new Date(evaluation.evaluationPeriod);
                    const toDate = new Date(dateTo);
                    if (evalDate > toDate) passesFilter = false;
                }
                
                // Cargo filter
                if (cargo && evaluation.cargo !== cargo) {
                    passesFilter = false;
                }
                
                return passesFilter;
            });
            
            updateDashboard();
        }

        function clearFilters() {
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('filterCargo').value = '';
            document.getElementById('filterMetric').value = 'total';
            
            filteredEvaluations = [...allEvaluations];
            updateDashboard();
        }

        function updateDashboard() {
            updateStatistics();
            updateRankingChart();
            updatePerformanceChart();
            updateEvaluationsTable();
        }

        function updateStatistics() {
            const totalEvals = filteredEvaluations.length;
            document.getElementById('totalEvaluations').textContent = totalEvals;
            
            if (totalEvals === 0) {
                document.getElementById('averageScore').textContent = '0%';
                document.getElementById('topPerformer').textContent = '-';
                document.getElementById('totalBadges').textContent = '0';
                return;
            }
            
            // Calculate average score
            const totalScore = filteredEvaluations.reduce((sum, eval) => {
                return sum + parseInt(eval.totalScore.replace('%', ''));
            }, 0);
            const averageScore = Math.round(totalScore / totalEvals);
            document.getElementById('averageScore').textContent = `${averageScore}%`;
            
            // Find top performer
            const topPerformer = filteredEvaluations.reduce((top, current) => {
                const currentScore = parseInt(current.totalScore.replace('%', ''));
                const topScore = parseInt(top.totalScore.replace('%', ''));
                return currentScore > topScore ? current : top;
            });
            document.getElementById('topPerformer').textContent = topPerformer.employeeName;
            
            // Calculate total badges
            const totalBadges = filteredEvaluations.reduce((sum, eval) => {
                return sum + (eval.badges ? eval.badges.length : 0);
            }, 0);
            document.getElementById('totalBadges').textContent = totalBadges;
        }

        function updateRankingChart() {
            const metric = document.getElementById('filterMetric').value;
            const chartContainer = document.getElementById('rankingChart');
            
            // Sort evaluations by selected metric
            const sortedEvaluations = [...filteredEvaluations].sort((a, b) => {
                let valueA, valueB;
                
                switch (metric) {
                    case 'skills':
                        valueA = calculateSkillsScore(a);
                        valueB = calculateSkillsScore(b);
                        break;
                    case 'operations':
                        valueA = calculateOperationsScore(a);
                        valueB = calculateOperationsScore(b);
                        break;
                    case 'badges':
                        valueA = a.badges ? a.badges.length : 0;
                        valueB = b.badges ? b.badges.length : 0;
                        break;
                    case 'points':
                        valueA = a.achievementPoints || 0;
                        valueB = b.achievementPoints || 0;
                        break;
                    default: // total
                        valueA = parseInt(a.totalScore.replace('%', ''));
                        valueB = parseInt(b.totalScore.replace('%', ''));
                }
                
                return valueB - valueA;
            });
            
            // Generate ranking HTML
            let rankingHTML = '';
            sortedEvaluations.slice(0, 10).forEach((evaluation, index) => {
                let value, unit;
                
                switch (metric) {
                    case 'skills':
                        value = calculateSkillsScore(evaluation).toFixed(1);
                        unit = '%';
                        break;
                    case 'operations':
                        value = calculateOperationsScore(evaluation).toFixed(1);
                        unit = '%';
                        break;
                    case 'badges':
                        value = evaluation.badges ? evaluation.badges.length : 0;
                        unit = ' insignias';
                        break;
                    case 'points':
                        value = evaluation.achievementPoints || 0;
                        unit = ' pts';
                        break;
                    default:
                        value = evaluation.totalScore.replace('%', '');
                        unit = '%';
                }
                
                const medalEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const cargoNames = {
                    'analista-calidad': 'Analista de Calidad',
                    'supervisor-operativo': 'Supervisor Operativo',
                    'supervisor-calidad': 'Supervisor de Calidad',
                    'coordinador-operativo': 'Coordinador Operativo',
                    'coordinador-calidad': 'Coordinador de Calidad'
                };
                
                rankingHTML += `
                    <div class="flex items-center justify-between p-3 border-b border-gray-100 hover:bg-gray-50">
                        <div class="flex items-center">
                            <span class="text-lg font-bold mr-3 w-8">${medalEmoji}</span>
                            <div>
                                <div class="font-medium text-gray-800">${evaluation.employeeName}</div>
                                <div class="text-sm text-gray-500">${cargoNames[evaluation.cargo] || evaluation.cargo}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-lg text-blue-600">${value}${unit}</div>
                            <div class="text-xs text-gray-500">${evaluation.evaluationPeriod}</div>
                        </div>
                    </div>
                `;
            });
            
            chartContainer.innerHTML = rankingHTML || '<p class="text-gray-500 text-center py-8">No hay datos para mostrar</p>';
        }

        function updatePerformanceChart() {
            const chartContainer = document.getElementById('performanceChart');
            
            // Count performance levels
            const performanceCounts = {
                'Desempe√±o Sobresaliente': 0,
                'Desempe√±o Bueno': 0,
                'Desempe√±o Regular': 0,
                'Desempe√±o Deficiente': 0
            };
            
            filteredEvaluations.forEach(evaluation => {
                if (performanceCounts.hasOwnProperty(evaluation.performanceLevel)) {
                    performanceCounts[evaluation.performanceLevel]++;
                }
            });
            
            const total = filteredEvaluations.length;
            
            let chartHTML = '';
            const colors = {
                'Desempe√±o Sobresaliente': 'bg-green-500',
                'Desempe√±o Bueno': 'bg-blue-500',
                'Desempe√±o Regular': 'bg-yellow-500',
                'Desempe√±o Deficiente': 'bg-red-500'
            };
            
            Object.entries(performanceCounts).forEach(([level, count]) => {
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                chartHTML += `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">${level}</span>
                            <span class="text-sm text-gray-500">${count} (${percentage}%)</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="${colors[level]} h-3 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });
            
            chartContainer.innerHTML = chartHTML || '<p class="text-gray-500 text-center py-8">No hay datos para mostrar</p>';
        }

        function updateEvaluationsTable() {
            const tableBody = document.getElementById('evaluationsTable');
            
            let tableHTML = '';
            filteredEvaluations.forEach(evaluation => {
                const cargoNames = {
                    'analista-calidad': 'Analista de Calidad',
                    'supervisor-operativo': 'Supervisor Operativo',
                    'supervisor-calidad': 'Supervisor de Calidad',
                    'coordinador-operativo': 'Coordinador Operativo',
                    'coordinador-calidad': 'Coordinador de Calidad'
                };
                
                const skillsScore = calculateSkillsScore(evaluation);
                const operationsScore = calculateOperationsScore(evaluation);
                const badgeCount = evaluation.badges ? evaluation.badges.length : 0;
                const achievementPoints = evaluation.achievementPoints || 0;
                
                tableHTML += `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-4 py-3 font-medium text-gray-900">${evaluation.employeeName}</td>
                        <td class="px-4 py-3 text-gray-700">${cargoNames[evaluation.cargo] || evaluation.cargo}</td>
                        <td class="px-4 py-3 text-gray-700">${evaluation.evaluationPeriod}</td>
                        <td class="px-4 py-3 text-gray-700">${skillsScore.toFixed(1)}%</td>
                        <td class="px-4 py-3 text-gray-700">${operationsScore.toFixed(1)}%</td>
                        <td class="px-4 py-3 font-semibold text-blue-600">${evaluation.totalScore}</td>
                        <td class="px-4 py-3 text-gray-700">${badgeCount}</td>
                        <td class="px-4 py-3 text-gray-700">${achievementPoints}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs rounded-full ${getPerformanceBadgeClass(evaluation.performanceLevel)}">
                                ${evaluation.performanceLevel}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex space-x-2">
                                <button onclick="viewEvaluationDetails('${evaluation.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                    Ver Detalles
                                </button>
                                ${currentUser && currentUser.role === 'Admin' ? `
                                    <button onclick="editEvaluation('${evaluation.id}')" class="text-green-600 hover:text-green-800 text-sm font-medium">
                                        Editar
                                    </button>
                                    <button onclick="deleteEvaluation('${evaluation.id}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                        Eliminar
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML || '<tr><td colspan="10" class="px-4 py-8 text-center text-gray-500">No hay evaluaciones para mostrar</td></tr>';
        }

        function calculateSkillsScore(evaluation) {
            if (!evaluation.skills) return 0;
            
            let totalScore = 0;
            let itemCount = 0;
            
            Object.values(evaluation.skills).forEach(value => {
                if (value === 3) {
                    totalScore += 3.57;
                } else if (value === 2) {
                    totalScore += 1.79;
                }
                itemCount++;
            });
            
            return totalScore;
        }

        function calculateOperationsScore(evaluation) {
            if (!evaluation.operations) return 0;
            
            let totalScore = 0;
            let itemCount = 0;
            
            Object.values(evaluation.operations).forEach(value => {
                if (value === 3) {
                    totalScore += 10;
                } else if (value === 2) {
                    totalScore += 5;
                }
                itemCount++;
            });
            
            return totalScore;
        }

        function getPerformanceBadgeClass(level) {
            switch (level) {
                case 'Desempe√±o Sobresaliente':
                    return 'bg-green-100 text-green-800';
                case 'Desempe√±o Bueno':
                    return 'bg-blue-100 text-blue-800';
                case 'Desempe√±o Regular':
                    return 'bg-yellow-100 text-yellow-800';
                case 'Desempe√±o Deficiente':
                    return 'bg-red-100 text-red-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }

        function viewEvaluationDetails(evaluationId) {
            const evaluation = allEvaluations.find(eval => eval.id === evaluationId);
            if (!evaluation) return;
            
            const periodText = evaluation.evaluationPeriodFrom && evaluation.evaluationPeriodTo ? 
                `${evaluation.evaluationPeriodFrom} al ${evaluation.evaluationPeriodTo}` : 
                evaluation.evaluationPeriod || 'No especificado';
            
            alert(`Detalles de la evaluaci√≥n:\n\nEmpleado: ${evaluation.employeeName}\nEvaluador: ${evaluation.evaluator}\nPer√≠odo: ${periodText}\nCreado por: ${evaluation.createdBy || 'No especificado'}\nPuntuaci√≥n Total: ${evaluation.totalScore}\nNivel: ${evaluation.performanceLevel}\n\nInsignias obtenidas: ${evaluation.badges ? evaluation.badges.length : 0}\nPuntos de logros: ${evaluation.achievementPoints || 0}`);
        }
        
        function editEvaluation(evaluationId) {
            if (!currentUser || currentUser.role !== 'Admin') {
                alert('Solo los administradores pueden editar evaluaciones.');
                return;
            }
            
            const evaluation = allEvaluations.find(eval => eval.id === evaluationId);
            if (!evaluation) return;
            
            // For now, show a simple edit dialog
            const newEmployeeName = prompt('Nombre del empleado:', evaluation.employeeName);
            if (newEmployeeName === null) return; // User cancelled
            
            const newEvaluator = prompt('Evaluador:', evaluation.evaluator);
            if (newEvaluator === null) return;
            
            // Update the evaluation
            evaluation.employeeName = newEmployeeName;
            evaluation.evaluator = newEvaluator;
            evaluation.lastModified = new Date().toISOString();
            evaluation.modifiedBy = currentUser.username;
            
            // Update in API and localStorage
            updateEvaluationInAPI(evaluation);
        }
        
        function deleteEvaluation(evaluationId) {
            if (!currentUser || currentUser.role !== 'Admin') {
                alert('Solo los administradores pueden eliminar evaluaciones.');
                return;
            }
            
            const evaluation = allEvaluations.find(eval => eval.id === evaluationId);
            if (!evaluation) return;
            
            if (confirm(`¬øEst√° seguro de que desea eliminar la evaluaci√≥n de ${evaluation.employeeName}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                deleteEvaluationFromAPI(evaluationId);
            }
        }
        
        async function updateEvaluationInAPI(evaluation) {
            try {
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                loadingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                        <span class="text-sm">Actualizando...</span>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
                
                // Flatten the data for API
                const flattenedData = {
                    id: evaluation.id,
                    employeeName: evaluation.employeeName,
                    evaluationPeriodFrom: evaluation.evaluationPeriodFrom,
                    evaluationPeriodTo: evaluation.evaluationPeriodTo,
                    evaluator: evaluation.evaluator,
                    cargo: evaluation.cargo,
                    createdBy: evaluation.createdBy,
                    timestamp: evaluation.timestamp,
                    totalScore: evaluation.totalScore,
                    performanceLevel: evaluation.performanceLevel,
                    badges: JSON.stringify(evaluation.badges || []),
                    achievementLevel: evaluation.achievementLevel || '',
                    achievementPoints: evaluation.achievementPoints || 0,
                    skills: JSON.stringify(evaluation.skills || {}),
                    operations: JSON.stringify(evaluation.operations || {}),
                    comments: JSON.stringify(evaluation.comments || {}),
                    lastModified: evaluation.lastModified,
                    modifiedBy: evaluation.modifiedBy
                };
                
                // Update in SheetDB API
                const response = await fetch(`https://sheetdb.io/api/v1/y605fdzbz5fir/id/${evaluation.id}`, {
                    method: 'PATCH',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data: flattenedData
                    })
                });
                
                loadingDiv.remove();
                
                if (response.ok) {
                    // Update localStorage
                    const index = allEvaluations.findIndex(eval => eval.id === evaluation.id);
                    if (index !== -1) {
                        allEvaluations[index] = evaluation;
                        localStorage.setItem('performanceEvaluations', JSON.stringify(allEvaluations));
                    }
                    
                    // Refresh dashboard
                    filteredEvaluations = [...allEvaluations];
                    updateDashboard();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="mr-2">‚úÖ</span>
                            <span class="text-sm">Evaluaci√≥n actualizada</span>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    setTimeout(() => {
                        if (successDiv.parentElement) {
                            successDiv.remove();
                        }
                    }, 3000);
                    
                } else {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error updating evaluation:', error);
                
                // Remove loading message
                const loadingDiv = document.querySelector('.fixed.top-4.right-4.bg-blue-500');
                if (loadingDiv) loadingDiv.remove();
                
                alert('Error al actualizar la evaluaci√≥n en la base de datos.');
            }
        }
        
        async function deleteEvaluationFromAPI(evaluationId) {
            try {
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                loadingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                        <span class="text-sm">Eliminando...</span>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
                
                // Delete from SheetDB API
                const response = await fetch(`https://sheetdb.io/api/v1/y605fdzbz5fir/id/${evaluationId}`, {
                    method: 'DELETE'
                });
                
                loadingDiv.remove();
                
                if (response.ok) {
                    // Remove from local arrays
                    allEvaluations = allEvaluations.filter(eval => eval.id !== evaluationId);
                    filteredEvaluations = filteredEvaluations.filter(eval => eval.id !== evaluationId);
                    
                    // Update localStorage
                    localStorage.setItem('performanceEvaluations', JSON.stringify(allEvaluations));
                    
                    // Refresh dashboard
                    updateDashboard();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="mr-2">üóëÔ∏è</span>
                            <span class="text-sm">Evaluaci√≥n eliminada</span>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    setTimeout(() => {
                        if (successDiv.parentElement) {
                            successDiv.remove();
                        }
                    }, 3000);
                    
                } else {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error deleting evaluation:', error);
                
                // Remove loading message
                const loadingDiv = document.querySelector('.fixed.top-4.right-4.bg-red-500');
                if (loadingDiv) loadingDiv.remove();
                
                alert('Error al eliminar la evaluaci√≥n de la base de datos.');
            }
        }

        function exportDashboardData() {
            try {
                if (filteredEvaluations.length === 0) {
                    alert('No hay evaluaciones para exportar. Aplique filtros diferentes o agregue evaluaciones.');
                    return;
                }

                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                loadingDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                        <span>Generando archivo Excel...</span>
                    </div>
                `;
                document.body.appendChild(loadingDiv);

                // Prepare data for Excel export
                const cargoNames = {
                    'analista-calidad': 'Analista de Calidad y Capacitaci√≥n',
                    'supervisor-operativo': 'Supervisor Operativo',
                    'supervisor-calidad': 'Supervisor de Calidad y Capacitaci√≥n',
                    'coordinador-operativo': 'Coordinador Operativo',
                    'coordinador-calidad': 'Coordinador de Calidad y Capacitaci√≥n'
                };

                // Create main evaluations sheet data
                const evaluationsData = filteredEvaluations.map(evaluation => {
                    const skillsScore = calculateSkillsScore(evaluation);
                    const operationsScore = calculateOperationsScore(evaluation);
                    const badgesList = evaluation.badges ? evaluation.badges.join(', ') : 'Ninguna';
                    
                    return {
                        'ID Evaluaci√≥n': evaluation.id,
                        'Nombre del Empleado': evaluation.employeeName,
                        'Cargo': cargoNames[evaluation.cargo] || evaluation.cargo,
                        'Fecha de Evaluaci√≥n': evaluation.evaluationPeriod,
                        'Evaluador': evaluation.evaluator,
                        'Puntuaci√≥n Habilidades (%)': skillsScore.toFixed(1),
                        'Puntuaci√≥n Operatividad (%)': operationsScore.toFixed(1),
                        'Puntuaci√≥n Total (%)': evaluation.totalScore.replace('%', ''),
                        'Nivel de Desempe√±o': evaluation.performanceLevel,
                        'Insignias Obtenidas': badgesList,
                        'Cantidad de Insignias': evaluation.badges ? evaluation.badges.length : 0,
                        'Nivel de Logros': evaluation.achievementLevel || 'No asignado',
                        'Puntos de Logros': evaluation.achievementPoints || 0,
                        'Fecha de Registro': new Date(evaluation.timestamp).toLocaleDateString('es-ES')
                    };
                });

                // Create detailed skills breakdown sheet
                const skillsBreakdownData = [];
                filteredEvaluations.forEach(evaluation => {
                    if (evaluation.skills) {
                        Object.entries(evaluation.skills).forEach(([skill, rating]) => {
                            const ratingText = rating === 3 ? 'Posee la cualidad' : 
                                             rating === 2 ? 'Posee con oportunidad de mejora' : 'No la posee';
                            skillsBreakdownData.push({
                                'Empleado': evaluation.employeeName,
                                'Cargo': cargoNames[evaluation.cargo] || evaluation.cargo,
                                'Fecha': evaluation.evaluationPeriod,
                                'Habilidad': skill,
                                'Puntuaci√≥n': rating,
                                'Descripci√≥n': ratingText
                            });
                        });
                    }
                });

                // Create operations breakdown sheet
                const operationsBreakdownData = [];
                filteredEvaluations.forEach(evaluation => {
                    if (evaluation.operations) {
                        Object.entries(evaluation.operations).forEach(([operation, rating]) => {
                            const ratingText = rating === 3 ? 'Posee la cualidad' : 
                                             rating === 2 ? 'Posee con oportunidad de mejora' : 'No la posee';
                            operationsBreakdownData.push({
                                'Empleado': evaluation.employeeName,
                                'Cargo': cargoNames[evaluation.cargo] || evaluation.cargo,
                                'Fecha': evaluation.evaluationPeriod,
                                'Aspecto Operativo': operation,
                                'Puntuaci√≥n': rating,
                                'Descripci√≥n': ratingText
                            });
                        });
                    }
                });

                // Create statistics summary sheet
                const totalEvals = filteredEvaluations.length;
                const averageScore = totalEvals > 0 ? 
                    Math.round(filteredEvaluations.reduce((sum, eval) => sum + parseInt(eval.totalScore.replace('%', '')), 0) / totalEvals) : 0;
                const totalBadges = filteredEvaluations.reduce((sum, eval) => sum + (eval.badges ? eval.badges.length : 0), 0);
                
                const performanceCounts = {
                    'Desempe√±o Sobresaliente': 0,
                    'Desempe√±o Bueno': 0,
                    'Desempe√±o Regular': 0,
                    'Desempe√±o Deficiente': 0
                };
                
                filteredEvaluations.forEach(evaluation => {
                    if (performanceCounts.hasOwnProperty(evaluation.performanceLevel)) {
                        performanceCounts[evaluation.performanceLevel]++;
                    }
                });

                const statisticsData = [
                    { 'M√©trica': 'Total de Evaluaciones', 'Valor': totalEvals },
                    { 'M√©trica': 'Promedio General (%)', 'Valor': averageScore },
                    { 'M√©trica': 'Total de Insignias', 'Valor': totalBadges },
                    { 'M√©trica': 'Desempe√±o Sobresaliente', 'Valor': performanceCounts['Desempe√±o Sobresaliente'] },
                    { 'M√©trica': 'Desempe√±o Bueno', 'Valor': performanceCounts['Desempe√±o Bueno'] },
                    { 'M√©trica': 'Desempe√±o Regular', 'Valor': performanceCounts['Desempe√±o Regular'] },
                    { 'M√©trica': 'Desempe√±o Deficiente', 'Valor': performanceCounts['Desempe√±o Deficiente'] },
                    { 'M√©trica': 'Fecha de Exportaci√≥n', 'Valor': new Date().toLocaleDateString('es-ES') }
                ];

                // Create workbook with multiple sheets
                const workbook = XLSX.utils.book_new();
                
                // Add main evaluations sheet
                const evaluationsSheet = XLSX.utils.json_to_sheet(evaluationsData);
                XLSX.utils.book_append_sheet(workbook, evaluationsSheet, 'Evaluaciones');
                
                // Add skills breakdown sheet
                if (skillsBreakdownData.length > 0) {
                    const skillsSheet = XLSX.utils.json_to_sheet(skillsBreakdownData);
                    XLSX.utils.book_append_sheet(workbook, skillsSheet, 'Detalle Habilidades');
                }
                
                // Add operations breakdown sheet
                if (operationsBreakdownData.length > 0) {
                    const operationsSheet = XLSX.utils.json_to_sheet(operationsBreakdownData);
                    XLSX.utils.book_append_sheet(workbook, operationsSheet, 'Detalle Operatividad');
                }
                
                // Add statistics sheet
                const statisticsSheet = XLSX.utils.json_to_sheet(statisticsData);
                XLSX.utils.book_append_sheet(workbook, statisticsSheet, 'Estad√≠sticas');

                // Generate filename
                const currentDate = new Date().toISOString().split('T')[0];
                const filename = `Evaluaciones_Desempe√±o_${currentDate}.xlsx`;
                
                // Write and download the file
                setTimeout(() => {
                    XLSX.writeFile(workbook, filename);
                    
                    // Remove loading message
                    loadingDiv.remove();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="mr-2">üìä</span>
                            <div>
                                <div class="font-semibold">Excel Exportado Exitosamente</div>
                                <div class="text-sm">${totalEvals} evaluaciones ‚Ä¢ 4 hojas de c√°lculo</div>
                                <div class="text-xs mt-1">${filename}</div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    setTimeout(() => {
                        successDiv.remove();
                    }, 5000);
                }, 500);
                
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                
                // Remove loading message if it exists
                const loadingDiv = document.querySelector('.fixed.top-4.right-4.bg-blue-500');
                if (loadingDiv) loadingDiv.remove();
                
                alert('Error al exportar a Excel: ' + error.message);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d38d992140f535',t:'MTc1NDg3MTQ3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
